# UTXO Output

UTXO 输出使用 Poseidon 哈希计算出一个 Hash Commitment。

## Commitment

Commitment 是一个哈希承诺，使用这样的算法进行计算：

$$
Commitment = H(Asset, Amount, OwnerAddr, SpentAddr, FreezeFlag, Random)
$$

> 这个表类型表达的结构被称为 `OpenedCommitment`。

| Name         | Type    | Comment                                                                  |
| ------------ | ------- | ------------------------------------------------------------------------ |
| `AssetId`    | uint254 | 资产类型 ，由 `AuditPublicKey`，`FreezeAddress` 和 `Random` 哈希计算得到 |
| `Amount`     | uint254 | 金额                                                                     |
| `OwnerAddr`  | uint254 | $OwnerAddr = H(OwnerKey)$，持有 `OwnerKey` 的人可以花费资产              |
| `SpentAddr`  | uint254 | $SpentAddr = H(SpentKey)$， `SpentKey` 用于计算 `Nullifier`              |
| `FreezeFlag` | uint254 | 冻结标识，为 1 则不可花费                                                |
| `Random`     | uint254 | 随机数                                                                   |
| `ExtraHash`  | uint254 | 编码了一些额外的信息的 hash                                              |

## AssetId

AssetId 也是一个哈希结果，它使用如下的算法进行计算：

$$
AssetId = H(AuditPublicKey, FreezeAddr, Random)
$$

| Name             | Type    | Comment                                                                              |
| ---------------- | ------- | ------------------------------------------------------------------------------------ |
| `AuditPublicKey` | point   | $AuditPublicKey = AuditKey * G$，持有 `AuditKey` 的人可以解密 `AduitMemo`            |
| `FreezeAddr`     | uint254 | $FreezeAddr = H(FreezeKey)$， 持有 FreezeKey 的人可以调用 Freeze 电路冻结 Commitment |
| `Random`         | uint254 | 随机数                                                                               |

## OwnerMemo

OwnerMemo 加密了足够计算出 `Commitment` 和 `Nullifier` 的信息。持有 `ViewKey` 可以解密。

OwnerMemo 按照如下顺序编码：

1. `AssetId`
2. `Amount`
3. `OwnerAddr`
4. `SpentKey`
5. `Random`
6. `ExtraData`: `uint254[]`，可以编码一些额外数据。

加密这些数据，需要使用 `ViewingPubKey`。

> Note:
>
> $ViewingPubKey=ViewingKey * G$
>
> `ExtraData` 记录了一些额外信息， $ExtraHash = H(ExtraData..)$
>
> `OwnerMemo` 中并不存在 `FreezeFlag` ，但是这个值只有两种可能性，可以利用 `Commitment` 猜测出来。

## Nullifier

`Nullifier` 表示一个 `Commitment` 已经被花费，只有使用 `SpentKey` 才可以计算出 `Nullifier`。

$$
Nullifier = H(Commitment, SpentKey)
$$
